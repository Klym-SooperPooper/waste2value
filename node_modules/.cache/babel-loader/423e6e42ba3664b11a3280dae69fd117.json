{"remainingRequest":"C:\\Apps\\beeko2\\node_modules\\thread-loader\\dist\\cjs.js!C:\\Apps\\beeko2\\node_modules\\babel-loader\\lib\\index.js!C:\\APPS\\beeko2\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Apps\\beeko2\\src\\store.js","dependencies":[{"path":"C:\\Apps\\beeko2\\src\\store.js","mtime":1606854338001},{"path":"C:\\Apps\\beeko2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Apps\\beeko2\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Apps\\beeko2\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\APPS\\beeko2\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuc3ltYm9sIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZmlsdGVyIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZW50cmllcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5mcm9tLWVudHJpZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcnMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcuaXRlcmF0b3IiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvd2ViLmRvbS1jb2xsZWN0aW9ucy5pdGVyYXRvciI7CmltcG9ydCBfZGVmaW5lUHJvcGVydHkgZnJvbSAiQzpcXEFwcHNcXGJlZWtvMlxcbm9kZV9tb2R1bGVzXFxAYmFiZWxcXHJ1bnRpbWUtY29yZWpzMy9oZWxwZXJzL2VzbS9kZWZpbmVQcm9wZXJ0eSI7CmltcG9ydCAicmVnZW5lcmF0b3ItcnVudGltZS9ydW50aW1lIjsKCmZ1bmN0aW9uIG93bktleXMob2JqZWN0LCBlbnVtZXJhYmxlT25seSkgeyB2YXIga2V5cyA9IE9iamVjdC5rZXlzKG9iamVjdCk7IGlmIChPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKSB7IHZhciBzeW1ib2xzID0gT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhvYmplY3QpOyBpZiAoZW51bWVyYWJsZU9ubHkpIHN5bWJvbHMgPSBzeW1ib2xzLmZpbHRlcihmdW5jdGlvbiAoc3ltKSB7IHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iamVjdCwgc3ltKS5lbnVtZXJhYmxlOyB9KTsga2V5cy5wdXNoLmFwcGx5KGtleXMsIHN5bWJvbHMpOyB9IHJldHVybiBrZXlzOyB9CgpmdW5jdGlvbiBfb2JqZWN0U3ByZWFkKHRhcmdldCkgeyBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgeyB2YXIgc291cmNlID0gYXJndW1lbnRzW2ldICE9IG51bGwgPyBhcmd1bWVudHNbaV0gOiB7fTsgaWYgKGkgJSAyKSB7IG93bktleXMoc291cmNlLCB0cnVlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgX2RlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBzb3VyY2Vba2V5XSk7IH0pOyB9IGVsc2UgaWYgKE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcnMoc291cmNlKSk7IH0gZWxzZSB7IG93bktleXMoc291cmNlKS5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHNvdXJjZSwga2V5KSk7IH0pOyB9IH0gcmV0dXJuIHRhcmdldDsgfQoKaW1wb3J0IFZ1ZSBmcm9tICd2dWUnOwppbXBvcnQgVnVleCBmcm9tICd2dWV4JzsKaW1wb3J0IGZpcmViYXNlLCB7IGRiIH0gZnJvbSAiLi9maXJlYmFzZSI7CmltcG9ydCBjcmVhdGVQZXJzaXN0ZWRTdGF0ZSBmcm9tICd2dWV4LXBlcnNpc3RlZHN0YXRlJzsKVnVlLnVzZShWdWV4KTsKdmFyIHN0b3JlID0gbmV3IFZ1ZXguU3RvcmUoewogIHN0YXRlOiB7CiAgICBxcjogMSwKICAgIGRiOiBkYiwKICAgIHVzZXI6IG51bGwKICB9LAogIG11dGF0aW9uczogewogICAgdXNlclVwZGF0ZWQ6IGZ1bmN0aW9uIHVzZXJVcGRhdGVkKHN0YXRlLCB1c2VyKSB7CiAgICAgIHN0YXRlLnVzZXIgPSB1c2VyOwogICAgfQogIH0sCiAgcGx1Z2luczogW2NyZWF0ZVBlcnNpc3RlZFN0YXRlKHsKICAgIHJlZHVjZXI6IGZ1bmN0aW9uIHJlZHVjZXIocGVyc2lzdGVkU3RhdGUpIHsKICAgICAgdmFyIHN0YXRlTWFwID0gbmV3IE1hcChPYmplY3QuZW50cmllcyhwZXJzaXN0ZWRTdGF0ZSkpOwogICAgICB2YXIgYmxhY2tMaXN0ID0gWydkYiddOwogICAgICBibGFja0xpc3QuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICAgICAgc3RhdGVNYXAuZGVsZXRlKGtleSk7CiAgICAgIH0pOwogICAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKHN0YXRlTWFwKTsKICAgIH0KICB9KV0KfSk7CnZhciBsaXN0ZW5lciA9IG51bGw7CmZpcmViYXNlLmF1dGgoKS5vbkF1dGhTdGF0ZUNoYW5nZWQoZnVuY3Rpb24gX2NhbGxlZShmaXJlYmFzZVVzZXIpIHsKICB2YXIgdXNlckRvYywgdXNlckRhdGE7CiAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hc3luYyhmdW5jdGlvbiBfY2FsbGVlJChfY29udGV4dCkgewogICAgd2hpbGUgKDEpIHsKICAgICAgc3dpdGNoIChfY29udGV4dC5wcmV2ID0gX2NvbnRleHQubmV4dCkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGlmIChsaXN0ZW5lcikgewogICAgICAgICAgICBsaXN0ZW5lci5yZW1vdmUoKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZpcmViYXNlVXNlcikgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIF9jb250ZXh0Lm5leHQgPSA0OwogICAgICAgICAgcmV0dXJuIHJlZ2VuZXJhdG9yUnVudGltZS5hd3JhcChzdG9yZS5zdGF0ZS5kYi5jb2xsZWN0aW9uKCd1c2VycycpLmRvYyhmaXJlYmFzZVVzZXIudWlkKS5nZXQoKSk7CgogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHVzZXJEb2MgPSBfY29udGV4dC5zZW50OwoKICAgICAgICAgIGlmICh1c2VyRG9jLmV4aXN0cykgewogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gNzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgcmV0dXJuIF9jb250ZXh0LmFicnVwdCgicmV0dXJuIiwgZmFsc2UpOwoKICAgICAgICBjYXNlIDc6CiAgICAgICAgICB1c2VyRGF0YSA9IHVzZXJEb2MuZGF0YSgpOwogICAgICAgICAgaWYgKGlzTmFOKHVzZXJEYXRhLnRva2VucykpIHVzZXJEYXRhLnRva2VucyA9IDA7CiAgICAgICAgICBpZiAoaXNOYU4odXNlckRhdGEuYm9udXMpKSB1c2VyRGF0YS5ib251cyA9IDA7CiAgICAgICAgICBzdG9yZS5jb21taXQoJ3VzZXJVcGRhdGVkJywgX29iamVjdFNwcmVhZCh7fSwgdXNlckRhdGEsIHsKICAgICAgICAgICAgdWlkOiBmaXJlYmFzZVVzZXIudWlkCiAgICAgICAgICB9KSk7CiAgICAgICAgICBsaXN0ZW5lciA9IHN0b3JlLnN0YXRlLmRiLmNvbGxlY3Rpb24oJ3VzZXJzJykuZG9jKGZpcmViYXNlVXNlci51aWQpLm9uU25hcHNob3QoZnVuY3Rpb24gKGRvYykgewogICAgICAgICAgICB2YXIgdXNlckRhdGEgPSBkb2MuZGF0YSgpOwogICAgICAgICAgICBzdG9yZS5jb21taXQoJ3VzZXJVcGRhdGVkJywgX29iamVjdFNwcmVhZCh7fSwgdXNlckRhdGEsIHsKICAgICAgICAgICAgICB1aWQ6IGZpcmViYXNlVXNlci51aWQKICAgICAgICAgICAgfSkpOwogICAgICAgICAgfSk7CiAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTU7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSAxNDoKICAgICAgICAgIC8vIFNpZ24gb3V0CiAgICAgICAgICBzdG9yZS5jb21taXQoJ3VzZXJVcGRhdGVkJywgbnVsbCk7CgogICAgICAgIGNhc2UgMTU6CiAgICAgICAgY2FzZSAiZW5kIjoKICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgIH0KICAgIH0KICB9KTsKfSk7CmV4cG9ydCBkZWZhdWx0IHN0b3JlOw=="},{"version":3,"sources":["C:/Apps/beeko2/src/store.js"],"names":["Vue","Vuex","firebase","db","createPersistedState","use","store","Store","state","qr","user","mutations","userUpdated","plugins","reducer","persistedState","stateMap","Map","Object","entries","blackList","forEach","key","delete","fromEntries","listener","auth","onAuthStateChanged","firebaseUser","remove","collection","doc","uid","get","userDoc","exists","userData","data","isNaN","tokens","bonus","commit","onSnapshot"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,OAAOA,GAAP,MAAgB,KAAhB;AACA,OAAOC,IAAP,MAAiB,MAAjB;AACA,OAAOC,QAAP,IAAmBC,EAAnB;AAEA,OAAOC,oBAAP,MAAiC,qBAAjC;AAEAJ,GAAG,CAACK,GAAJ,CAAQJ,IAAR;AAEA,IAAMK,KAAK,GAAG,IAAIL,IAAI,CAACM,KAAT,CAAe;AAC5BC,EAAAA,KAAK,EAAE;AACNC,IAAAA,EAAE,EAAE,CADE;AAENN,IAAAA,EAAE,EAAFA,EAFM;AAGNO,IAAAA,IAAI,EAAE;AAHA,GADqB;AAM5BC,EAAAA,SAAS,EAAE;AACVC,IAAAA,WADU,uBACEJ,KADF,EACSE,IADT,EACe;AACxBF,MAAAA,KAAK,CAACE,IAAN,GAAaA,IAAb;AACA;AAHS,GANiB;AAW5BG,EAAAA,OAAO,EAAE,CACRT,oBAAoB,CAAC;AACpBU,IAAAA,OAAO,EAAE,iBAACC,cAAD,EAAoB;AAC5B,UAAMC,QAAQ,GAAG,IAAIC,GAAJ,CAAQC,MAAM,CAACC,OAAP,CAAeJ,cAAf,CAAR,CAAjB;AACA,UAAMK,SAAS,GAAG,CAAC,IAAD,CAAlB;AAEAA,MAAAA,SAAS,CAACC,OAAV,CAAkB,UAACC,GAAD,EAAS;AAC1BN,QAAAA,QAAQ,CAACO,MAAT,CAAgBD,GAAhB;AACA,OAFD;AAIA,aAAOJ,MAAM,CAACM,WAAP,CAAmBR,QAAnB,CAAP;AACA;AAVmB,GAAD,CADZ;AAXmB,CAAf,CAAd;AA2BA,IAAIS,QAAQ,GAAG,IAAf;AACAvB,QAAQ,CAACwB,IAAT,GAAgBC,kBAAhB,CAAmC,iBAAOC,YAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAClC,cAAIH,QAAJ,EAAc;AACbA,YAAAA,QAAQ,CAACI,MAAT;AACA;;AAHiC,eAI9BD,YAJ8B;AAAA;AAAA;AAAA;;AAAA;AAAA,0CAKXtB,KAAK,CAACE,KAAN,CAAYL,EAAZ,CACpB2B,UADoB,CACT,OADS,EAEpBC,GAFoB,CAEhBH,YAAY,CAACI,GAFG,EAGpBC,GAHoB,EALW;;AAAA;AAK3BC,UAAAA,OAL2B;;AAAA,cAU5BA,OAAO,CAACC,MAVoB;AAAA;AAAA;AAAA;;AAAA,2CAYzB,KAZyB;;AAAA;AAe3BC,UAAAA,QAf2B,GAehBF,OAAO,CAACG,IAAR,EAfgB;AAiBjC,cAAIC,KAAK,CAACF,QAAQ,CAACG,MAAV,CAAT,EAA4BH,QAAQ,CAACG,MAAT,GAAkB,CAAlB;AAC5B,cAAID,KAAK,CAACF,QAAQ,CAACI,KAAV,CAAT,EAA2BJ,QAAQ,CAACI,KAAT,GAAiB,CAAjB;AAE3BlC,UAAAA,KAAK,CAACmC,MAAN,CAAa,aAAb,oBAAiCL,QAAjC;AAA2CJ,YAAAA,GAAG,EAAEJ,YAAY,CAACI;AAA7D;AACAP,UAAAA,QAAQ,GAAGnB,KAAK,CAACE,KAAN,CAAYL,EAAZ,CACT2B,UADS,CACE,OADF,EAETC,GAFS,CAELH,YAAY,CAACI,GAFR,EAGTU,UAHS,CAGE,UAACX,GAAD,EAAS;AACpB,gBAAMK,QAAQ,GAAGL,GAAG,CAACM,IAAJ,EAAjB;AACA/B,YAAAA,KAAK,CAACmC,MAAN,CAAa,aAAb,oBAAiCL,QAAjC;AAA2CJ,cAAAA,GAAG,EAAEJ,YAAY,CAACI;AAA7D;AACA,WANS,CAAX;AArBiC;AAAA;;AAAA;AA6BjC;AACA1B,UAAAA,KAAK,CAACmC,MAAN,CAAa,aAAb,EAA4B,IAA5B;;AA9BiC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAnC;AAkCA,eAAenC,KAAf","sourcesContent":["import Vue from 'vue';\nimport Vuex from 'vuex';\nimport firebase, { db } from './firebase';\n\nimport createPersistedState from 'vuex-persistedstate';\n\nVue.use(Vuex);\n\nconst store = new Vuex.Store({\n\tstate: {\n\t\tqr: 1,\n\t\tdb,\n\t\tuser: null,\n\t},\n\tmutations: {\n\t\tuserUpdated(state, user) {\n\t\t\tstate.user = user;\n\t\t},\n\t},\n\tplugins: [\n\t\tcreatePersistedState({\n\t\t\treducer: (persistedState) => {\n\t\t\t\tconst stateMap = new Map(Object.entries(persistedState));\n\t\t\t\tconst blackList = ['db'];\n\n\t\t\t\tblackList.forEach((key) => {\n\t\t\t\t\tstateMap.delete(key);\n\t\t\t\t});\n\n\t\t\t\treturn Object.fromEntries(stateMap);\n\t\t\t},\n\t\t}),\n\t],\n});\n\nlet listener = null;\nfirebase.auth().onAuthStateChanged(async (firebaseUser) => {\n\tif (listener) {\n\t\tlistener.remove();\n\t}\n\tif (firebaseUser) {\n\t\tconst userDoc = await store.state.db\n\t\t\t.collection('users')\n\t\t\t.doc(firebaseUser.uid)\n\t\t\t.get();\n\n\t\tif (!userDoc.exists) {\n\t\t\t// Случай когда пользователь не зарегистрировался через систему, нужно либо провести через процесс регистрации либо проигнорировать\n\t\t\treturn false;\n\t\t}\n\n\t\tconst userData = userDoc.data();\n\n\t\tif (isNaN(userData.tokens)) userData.tokens = 0;\n\t\tif (isNaN(userData.bonus)) userData.bonus = 0;\n\n\t\tstore.commit('userUpdated', { ...userData, uid: firebaseUser.uid });\n\t\tlistener = store.state.db\n\t\t\t.collection('users')\n\t\t\t.doc(firebaseUser.uid)\n\t\t\t.onSnapshot((doc) => {\n\t\t\t\tconst userData = doc.data();\n\t\t\t\tstore.commit('userUpdated', { ...userData, uid: firebaseUser.uid });\n\t\t\t});\n\t} else {\n\t\t// Sign out\n\t\tstore.commit('userUpdated', null);\n\t}\n});\n\nexport default store;\n"]}]}