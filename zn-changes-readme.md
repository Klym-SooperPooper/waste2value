# Изменения

## Store, firebase, router вынесены в отдельные файлы

## QR.vue

1. при нажатии на кнопку запрашивается разрешение для камеры и запрашивается локация (плагин кордовы cordova-plugin-geolocation сам обрабатывает разрешения), возможно можно подключить cordova-plugin-qrscanner чтобы так же работать с чтением QR, но тогда нужен адаптер на вью
2. Убран хэндлер с маунта, если он будет необходим, лучше привязывать его в main.js/App.vue так как он будет создаваться при каждом заходе на страничку QR и надо либо следить за отвязкой, либо будет утекать память

## Wallet.vue

1. Методы переделаны в async, это пользовяет сократить кол-во вложений в асинхронном коде и упростить его
2. Транзакция на перевод токенов поправлена, firestore транзакции позволяют выполнять несколько операций блокируя изменение ресурсов пока транзакция выполняется, что собственно позволяет делать надежные переводы - изменения нескольких записей одновременно
3. Убрал пару использований `this.transferTokens` где `transferTokens` уже используется как аргумент функции, иначе баги

## Добавил makefile (для его работы нужна linux/wsl/macos система либо смотреть cygwin и подобные симуляторы терминалов для вин)

- `firebase-preview` и `firebase-deploy` собирают приложение в превью и живом режиме соответственно
- `generate-key` создает ключ для подписания апк !удаляет существующий перед созданием!
- `release` - собирает приложение, подписывает и готовит для загрузки в стор (zipalign)

Практически все в makefile настраивается через переменные

## Изменил путь сборки вью и деплоя фб в src-cordova/www чтобы не нужно было вручную все туда-сюда тягать

Иконка приложения прописана использовать `/public/img/app-icon`, вся папка `public` копируется в корень `src-cordova/www`, поэтому можно по желанию организовать все иконки в отдельной папке

## В роутере сделал использование сохраненного пользователя из Vuex, убрал асинхронный код из guard-функции

## Для публикации приложения в маркете

Надо создать его в https://play.google.com/console и там же оформить все нужные гуглу вопросы, дальше вроде просто загрузить подписанное приложение, но он ругался на пермишены камеры для которых нужно добавить соглашения конфиденциальности, поэтому не стал копаться.

Плюс маркет не видит\не заполнено какое-то требуемое поле в манифесте, выдает не локализованный код ошибки `VALIDATE_APP_MESSAGE_NO_FULL_DESCRIPTION` - скорее всего description или что-то не полностью заполнено

## Добавил prettier (https://prettier.io/docs/en/options.html) для форматирования кода.

Можно отключить удалив `.prettierrc.yaml` и сделав `npm remove prettier`

## Пробовал библиотеку vuefire (https://vuefire.vuejs.org/) для работы с firestore.

Помогает упростить подгрузку данных для синхронизации, идет в двух форматах для vue и vuex `store.state.user` возможно можно привязать через нее, не успел проверить и пока оставил обычный хэндлер в store.js.
